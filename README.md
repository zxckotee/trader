# ML проект на тему предсказания рынка с архитектурой MoE

Мы будем анализировать криптовалютный рынок на основе данных не только о нем, но и на основе политико-экономической позиции и фиатного/фондового рынка

## Стек

Будем по традиции работать на **Python** с фреймворками/библиотеками:

- Pytorch
- Transformers
- LoRA оптимизатор

## MoE

1. **Основной поток** - целевой поток. Обращает внимание на сам *График* рынка **КРИПТОВАЛЮТЫ**

2. **Параллельные потоки:** - модели, урезанные до момента формирования *logits* и после последнего *FFN->Layer Norm*

**Параллельные** потоки переходят в промежуточные слои **Основного**, добавляя градиент после *Multi-Head-Attention* каждого N-блока, таким образом влияя на его "рассуждение"

## Получение данных криптовалюты для обучения
 
Для начала делаем парсер с Bybit

Получение данных графика через REST API
Bybit предоставляет интерфейс GET /v5/market/kline, который позволяет получить массив данных OHLCV (Open, High, Low, Close, Volume) для выбранной криптовалюты.

Для успешного запроса вам понадобятся следующие ключевые параметры:

category: Категория продукта. Для большинства пар, таких как BTCUSDT, используется значение linear.

symbol: Название торговой пары (например, BTCUSDT или ETHUSDT).

interval: Временной интервал свечи. Доступные значения: 1, 5, 15, 30, 60, 120, 240 (минуты), D (день), W (неделя) и другие.

start и end: (Опционально) Временной диапазон, заданный в миллисекундах с 1 января 1970 года (Unix Epoch). Если не указан, вернутся последние данные.

limit: (Опционально) Количество возвращаемых свечей. Максимум 1000 за один запрос.

Поскольку API возвращает не более 1000 свечей за один запрос, для загрузки данных за несколько лет (например, с 2019 года) необходимо реализовать последовательные запросы (пагинацию). Вот пример логики на псевдокоде:

1. Установите начальную дату (startTime = 01.01.2019)
2. Установите конечную дату (endTime = текущий день)
3. Пока startTime < endTime:
    - Выполните запрос к API с параметрами start=startTime и limit=1000
    - Сохраните полученные данные
    - Обновите startTime = timestamp последней полученной свечи + 1
    - Добавьте небольшую задержку между запросами (например, 0.01 секунды)

## Получение данных фондового рынка для обучения

access key is: 0R1CMESM5CTZL9LF

TIME_SERIES_INTRADAY Тренды

Этот API возвращает текущие и исторические внутридневные данные OHLCV за более чем 20 лет по указанному активу, охватывающие предрыночные и послерыночные часы, где это применимо (например, с 4:00 до 20:00 по восточному времени для рынка США). С помощью этой конечной точки можно запрашивать как необработанные (как торгуемые), так и скорректированные с учётом дробления и дивидендов внутридневные данные. В финансовой литературе данные OHLCV иногда называют «свечами».


Параметры API
**Требуется**: function

Временной ряд по вашему выбору. В данном случае function=TIME_SERIES_INTRADAY

**Требуется**: symbol

Название компании по вашему выбору. Например: symbol=IBM

**Требуется**: interval

Временной интервал между двумя последовательными точками данных во временном ряду. Поддерживаются следующие значения: 1min, 5min, 15min, 30min, 60min

**Необязательно**: adjusted

По умолчанию adjusted=true и выходные временные ряды корректируются с учётом исторических событий, связанных с дроблением акций и выплатой дивидендов. Установите adjusted=false для запроса необработанных (как торгуемых) внутридневных значений.

**Необязательно**: extended_hours

По умолчанию extended_hours=true и выходные временные ряды будут включать как обычные торговые часы, так и расширенные (до и после закрытия торгов) торговые часы (с 4:00 до 20:00 по восточному времени для рынка США). Установите extended_hours=false для запроса только обычных торговых часов (с 9:30 до 16:00 по восточному времени для США).

**Необязательно**: month

По умолчанию этот параметр не задан, и API будет возвращать внутридневные данные за последние дни торгов. Вы можете использовать параметр month (в формате ГГГГ-ММ) для запроса данных за определенный месяц в истории. Например, month=2009-01. Поддерживается любой месяц за последние 20 с лишним лет, начиная с 2000-01 (январь 2000 года).

**Необязательно**: outputsize

По умолчанию outputsize=compact. Строки compact и full принимаются со следующими параметрами: compact возвращает только 100 последних точек данных во внутридневном временном ряду; full возвращает последние 30 дней самых свежих внутридневных данных, если параметр month (см. выше) не указан, или все внутридневные данные за определенный месяц в истории, если указан параметр month . Если вы хотите уменьшить размер данных при каждом вызове API, рекомендуется использовать параметр «compact».

**Необязательно**: datatype

По умолчанию datatype=json. Строки json и csv принимаются со следующими параметрами: json возвращает внутридневной временной ряд в формате JSON; csv возвращает временной ряд в виде файла CSV (значения, разделённые запятыми).

**Требуется**: apikey

Примеры (нажмите, чтобы увидеть вывод в формате JSON)
По умолчанию API возвращает 100 последних внутридневных баров OHLCV, если параметр outputsize не задан
https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=IBM&interval=5min&apikey=demo

Чтобы получить данные за последние 30 дней, установите параметр outputsize=full
https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=IBM&interval=5min&outputsize=full&apikey=demo

Запрос внутридневных данных за указанный месяц в истории (например, 2009-01). Поддерживается любой месяц за последние 20 с лишним лет (с 2000-01)
https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=IBM&interval=5min&month=2009-01&outputsize=full&apikey=demo

Загружаемый CSV-файл:
https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=IBM&interval=5min&apikey=demo&datatype=csv


## Мировые новости

Альфа-интеллект™
API-интерфейсы в этом разделе содержат расширенную аналитическую информацию о рынке, созданную на основе нашего многолетнего опыта в области искусственного интеллекта, машинного обучения и количественных финансов. Мы надеемся, что эти уникальные альтернативные наборы данных помогут вывести вашу торговую стратегию, исследования рынка и финансовое программное обеспечение на новый уровень.


Новости рынка и настроения в тренде
Ищете данные о новостях рынка, чтобы обучить свои модели LLM или усовершенствовать свою торговую стратегию? Вы их только что нашли. Этот API предоставляет актуальные и исторические данные о новостях и настроениях на рынке от большого и постоянно растущего числа ведущих новостных агентств по всему миру, освещающих акции, криптовалюты, валютный рынок и широкий спектр тем, таких как фискальная политика, слияния и поглощения, первичное размещение акций и т. д. Этот API в сочетании с нашим основным API для акций, фундаментальными данными и API для технических индикаторов может предоставить вам полную картину финансового рынка и экономики в целом.


Параметры API
❚ Требуется: function

Функция по вашему выбору. В данном случае function=NEWS_SENTIMENT

❚ Необязательно: tickers

Символы акций/криптовалют/форекса по вашему выбору. Например: tickers=IBM отфильтрует статьи, в которых упоминается тикер IBM; tickers=COIN,CRYPTO:BTC,FOREX:USD отфильтрует статьи, в которых одновременно упоминаются Coinbase (COIN), биткоин (CRYPTO:BTC) и доллар США (FOREX:USD).

❚ Необязательно: topics

Темы новостей на ваш выбор. Например: topics=technology отфильтрует статьи о технологическом секторе; topics=technology,ipo отфильтрует статьи, которые одновременно посвящены технологиям и IPO. Ниже приведён полный список поддерживаемых тем:

Блокчейн: blockchain
Заработок: earnings
IPO: ipo
Слияния и поглощения: mergers_and_acquisitions
Финансовые рынки: financial_markets
Экономика — фискальная политика (например, налоговая реформа, государственные расходы): economy_fiscal
Экономика — денежно-кредитная политика (например, процентные ставки, инфляция): economy_monetary
Экономика — макро/в целом: economy_macro
Энергетика и транспорт: energy_transportation
Финансы: finance
Науки о жизни: life_sciences
Производство: manufacturing
Недвижимость и строительство: real_estate
Розничная и оптовая торговля: retail_wholesale
ТЕХНОЛОГИЯ: technology
❚ Необязательно: time_from и time_to

Диапазон времени для новостных статей, на которые вы ориентируетесь, в формате ГГГГММДДЧЧММ. Например: time_from=20220410T0130. Если указано time_from, но отсутствует time_to, API вернет статьи, опубликованные в период между значением time_from и текущим временем.

❚ Необязательно: sort

По умолчанию sort=LATEST и API сначала возвращают самые свежие статьи. Вы также можете указать sort=EARLIEST или sort=RELEVANCE в зависимости от вашего сценария использования.

❚ Необязательно: limit

По умолчанию limit=50 и API возвращают до 50 подходящих результатов. Вы также можете настроить limit=1000 так, чтобы он возвращал до 1000 результатов.

❚ Требуется: apikey

Ваш ключ API. Получите бесплатный ключ API здесь.


Примеры (нажмите, чтобы увидеть вывод в формате JSON)
Поиск новостных статей, в которых упоминается тикер AAPL.
https://www.alphavantage.co/query?function=NEWS_SENTIMENT&tickers=AAPL&apikey=demo

Запрос на новостные статьи, в которых одновременно упоминаются акции Coinbase (COIN), биткоин (CRYPTO:BTC) и доллар США (FOREX:USD) и которые были опубликованы 10 апреля 2022 года в 13:30 по всемирному координированному времени или позже.
https://www.alphavantage.co/query?function=NEWS_SENTIMENT&tickers=COIN,CRYPTO:BTC,FOREX:USD&time_from=20220410T0130&limit=1000&apikey=demo

## Модели

Модель фондового рынка обучается похожим образом, что и модель криптовалютного рынка
Она вливает свой градиент только в модель крипторынка, но ЯЗЫКОВАЯ модель новостей под собой держит влиятельность больше: она наделяет сначала модель фондового рынка градиентом, которая наделяет модель криптовалютного рынка, а после того через FFN слой крипторынка языковая модель ОПЯТЬ наделяет ее своим градиентом

## Архитектура


    [Языковая модель]____________________
                        |                |
        [Фиатный рынок]_|___________     |
                                  |      |
[Крипторынок]---------------------| -----|---->

